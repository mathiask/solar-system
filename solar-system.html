<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<!-- <link href="css/some-stylesheet.css" -->
<!--       rel="stylesheet"/> -->
<!-- <script src="scripts/some-script.js"> -->
<!-- </script> -->
</head>
<body>
  <h1>Solar System Simulator</h1>
  <canvas id="canvas" style="border: 1px solid" width="600" height="600"></canvas>
<script>
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");
  const sunPos = [300, 300];

  function drawSun(ctx) {
      drawBody(ctx, sunPos, 20, "orange")
      ctx.beginPath();
      ctx.arc(300, 300, 20, 0, Math.PI * 2, true);
      ctx.closePath();
      ctx.fillStyle = "orange";
      ctx.fill();
  }

  function drawBody(ctx, pos, r, color) {
      ctx.beginPath();
      ctx.arc(pos[0], pos[1], r, 0, Math.PI * 2, true);
      ctx.closePath();
      ctx.fillStyle = color;
      ctx.fill();
  }

  const planets = [
      {pos: [500, 300], v: [0, -2], color: "blue" , trace: []},
      {pos: [500, 300], v: [0, -1], color: "green", trace: []},
      {pos: [400, 300], v: [0, -3], color: "red"  , trace: []},
  ];

  setInterval(draw, 10);

  function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawSun(ctx);
      drawPlanets(planets);
      updateAll(planets);
      //console.log(planet);
  }

  function drawPlanets(ps) {
      for (let p of ps) {
	  drawBody(ctx, p.pos, 5, p.color);
	  for (let pt of p.trace) {
	      drawBody(ctx, pt, 2, p.color);
	  }
      }
  }

  function updateAll(ps) {
      for (p of ps) update(p);
  }

  function update(p) {
      trace(p);
      updateV(p);
      updatePos(p);
  }

  function trace(p) {
      p.trace.push(p.pos);
      if (p.trace.length > 50) {
	  p.trace.shift();
      }
  }

  function updateV(p) {
      p.v = vecPlus(p.v, acc(p));
  }

  /**
   * F = ma
   * F = (G m m_S)/r^2 = Cm/r^2 (C = G m_S)
   * a = F/m = C/r^2
   */
  function acc(p) {
      let ps = vecMinus(sunPos, p.pos);
      let ad = vecNorm(ps);
      return vecScale(ad, 1000 / vecLength(ps)**2);
  }

  function vecMinus(v1, v2) {
      return vecPlus(v1, vecNeg(v2));
  }

  function vecNeg(v) {
      return [-v[0], -v[1]];
  }

  function vecPlus(v1, v2) {
      return [v1[0] + v2[0] , v1[1] + v2[1]];
  }

  function vecNorm(v) {
      return vecScale(v, 1 / vecLength(v));
  }

  function vecLength(v) {
      return Math.sqrt(v[0]*v[0] + v[1]*v[1]);
  }

  function vecScale(v, x) {
      return [x * v[0], x * v[1]];
  }

  function updatePos(p) {
      p.pos = vecPlus(p.pos, p.v);
  }



</script>
</body>
</html>
